syntax = "proto3";
package service;

option go_package = "github.com/callmeahab/pharma-search/gen;pb";

import "google/protobuf/struct.proto";

service PharmaAPI {
  rpc Health(HealthRequest) returns (HealthResponse) { }
  rpc Autocomplete(AutocompleteRequest) returns (AutocompleteResponse) { }
  rpc Search(SearchRequest) returns (GenericJsonResponse) { }
  rpc SearchGroups(SearchGroupsRequest) returns (GenericJsonResponse) { }
  rpc GetFacets(FacetsRequest) returns (GenericJsonResponse) { }
  rpc GetFeatured(FeaturedRequest) returns (GenericJsonResponse) { }
  rpc PriceComparison(PriceComparisonRequest) returns (GenericJsonResponse) { }
  rpc Contact(ContactRequest) returns (GenericJsonResponse) { }
  rpc ProcessProducts(ProcessRequest) returns (GenericJsonResponse) { }
  rpc ReprocessAll(ReprocessAllRequest) returns (GenericJsonResponse) { }
  rpc RebuildIndex(RebuildIndexRequest) returns (GenericJsonResponse) { }
  rpc ProcessingAnalysis(ProcessingAnalysisRequest) returns (GenericJsonResponse) { }
}

message GenericJsonResponse {
  google.protobuf.Struct data = 1;
}

message HealthRequest {}
message HealthResponse { string status = 1; }

message AutocompleteRequest { string q = 1; int32 limit = 2; }
message AutocompleteSuggestion { string id = 1; string title = 2; double price = 3; string vendor_name = 4; }
message AutocompleteResponse { repeated AutocompleteSuggestion suggestions = 1; string query = 2; int32 limit = 3; }

message SearchRequest {
  string q = 1;
  int32 limit = 2;
  int32 offset = 3;
  double min_price = 4;
  double max_price = 5;
  repeated string brand_names = 6;
  repeated string categories = 7;
  repeated string forms = 8;
  bool in_stock_only = 9;
}

message SearchGroupsRequest { string q = 1; int32 limit = 2; }
message FacetsRequest {}
message PriceComparisonRequest { string q = 1; }
message ContactRequest { string name = 1; string email = 2; string message = 3; }
message ProcessRequest { int32 batch_size = 1; }
message ReprocessAllRequest {}
message RebuildIndexRequest {}
message ProcessingAnalysisRequest {}
message FeaturedRequest { int32 limit = 1; }
